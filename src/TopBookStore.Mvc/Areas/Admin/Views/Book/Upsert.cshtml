@model BookListViewModel
@{
    ViewData["Title"] = ViewBag.Action == "Add" ? "Thêm Sách" : "Chỉnh Sửa Sách";
}

<form asp-action="Upsert" method="post" enctype="multipart/form-data">
    <div class="row p-3 border">
        <div class="col-md-12 border-bottom">
            <h2 class="text-primary">@ViewData["Title"]</h2>
        </div>
        <div class="col-md-8 pt-4">
            <input type="hidden" asp-for="Book.BookId" />

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="@Model.Book.Title">Tiêu đề</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" asp-for="Book.Title" />
                    <span class="text-danger" asp-validation-for="Book.Title"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="Book.Description">Mô tả</label>
                </div>
                <div class="col-md-9">
                    <textarea class="form-control" rows="6"
                        asp-for="Book.Description"></textarea>
                    <span class="text-danger" asp-validation-for="Book.Description"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="Book.Isbn13">Isbn13</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" asp-for="Book.Isbn13" />
                    <span class="text-danger" asp-validation-for="Book.Isbn13"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="Book.Inventory">Hàng tồn kho</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" asp-for="Book.Inventory" />
                    <span class="text-danger" asp-validation-for="Book.Inventory"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="Book.Price">Giá tiền</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" asp-for="Book.Price" />
                    <span class="text-danger" asp-validation-for="Book.Price"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="Book.DiscountPercent">Giảm giá</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" asp-for="Book.DiscountPercent" />
                    <span class="text-danger" asp-validation-for="Book.DiscountPercent"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="Book.NumberOfPages">Số trang</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" asp-for="Book.NumberOfPages" />
                    <span class="text-danger" asp-validation-for="Book.NumberOfPages"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label" asp-for="Book.PublicationDate">Ngày sản xuất</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" asp-for="Book.PublicationDate" />
                    <span class="text-danger" asp-validation-for="Book.PublicationDate"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label">Tác giả</label>
                </div>
                <div class="col-md-9">
                    <input id="authorName" class="form-control"
                        asp-for="Book.Author.FullName" />
                    <input id="authorId" type="hidden" asp-for="Book.AuthorId" />
                    <input type="hidden" asp-for="Book.Author.FirstName" />
                    <input type="hidden" asp-for="Book.Author.LastName" />
                    <span class="text-danger" asp-validation-for="Book.Author.FullName"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label">Nhà xuất bản</label>
                </div>
                <div class="col-md-9">
                    <input id="publisherName" class="form-control"
                        asp-for="Book.Publisher.Name" />
                    <input id="publisherId" type="hidden" asp-for="Book.PublisherId" />
                    <span class="text-danger" asp-validation-for="Book.Publisher.Name"></span>
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label">Thể loại</label>
                </div>
                <div class="col-md-9 checkbox-column">
                    @foreach (Category category in Model.Categories)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" 
                                id="category-@category.CategoryId"
                                checked="@CheckCategory.IsSelected(Model.Book, category)"
                                name="categoryIds" value="@category.CategoryId" />
                            <label class="form-check-label" for="category-@category.CategoryId">
                                @category.Name
                            </label>
                        </div>
                    }
                </div>
            </div>

            <div class="mb-3 row">
                <div class="col-md-3">
                    <label class="form-label"></label>Ảnh bìa</label>
                </div>
                <div class="col-md-9">
                    <input class="form-control" type="file" name="files" id="uploadBox" multiple />
                    <input type="hidden" asp-for="Book.ImageUrl">
                </div>
            </div>

            <partial name="_ActionOrReturnPartial" />
        </div>

        <div class="col-md-4">
            @if (Model.Book.ImageUrl is not null)
            {
                <img src="@Model.Book.ImageUrl" />
            }
            else
            {
                <img class="image" src="~/imgs/books/default.jpg" />
            }
        </div>
    </div>
</form>

@section scripts {
    <partial name="_ValidationScriptsPartial.cshtml"></partial>
    <script src="~/js/search/searchAuthor.js"></script>
    <script src="~/js/search/searchPublisher.js"></script>
}